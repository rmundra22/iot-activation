<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>IPsec</title>
  <meta name="description" content="Table of Contents  What is IPsec?          What will you need?      What does it do?        How to make your own IPsec VPN!          Request private APN to T...">
  <meta name="google-translate-customization" content="b9870a0c7376df54-aa35852016e6a5cc-ga0a0d80f6c171f17-e"></meta>
  <link rel="stylesheet" href="css/main.css">
  <link rel="canonical" href="http://localhost:4000/BPIPsec.html">
  <link href="/favicon.png" rel="icon">
  <!--link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"-->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="alternate" type="application/atom+xml" title="IoT Activation" href="http://localhost:4000/atom.xml" />
</head>


  <body>
         <div class="col-md-12 navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-inverse-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/iot-activation/">IoT Activation</a>
      </div>
      <div class="navbar-collapse collapse navbar-inverse-collapse">
        <ul class="nav navbar-nav">
          
            
          
            
              <!-- li><a href="/about.html">About</a></li-->
            
          
            
          
            
          
          
<!--           <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Pages<b class="caret"></b></a>
            <ul class="dropdown-menu">
            
              
            
              
                <li><a href="/about.html" style="text-transform : uppercase;">About</a></li>
              
            
              
            
              
            
            </ul>
          </li>
 -->        </ul>
       
        <ul class="nav navbar-nav navbar-right left-syms">
          <li><a href="https://iot.telefonica.com/blog" target="_blank"><i class="fa fa-rss"></i> <span>Blog</span></a></li>
          <li><a href="https://www.linkedin.com/showcase/telefonicaiot/" target="_blank"><i class="fa fa-linkedin"></i> <span>linkedin</span></a></li>
          <li><a href="//twitter.com/TelefonicaIoT" target="_blank"><i class="fa fa-twitter"></i> <span>Twitter</span></a></li>
          <li><a href="https://www.youtube.com/user/m2mtelefonica/featured" target="_blank"><i class="fa fa-youtube"></i> <span>Youtube</span></a></li>
          <li><a href="http://github.com/telefonicaid/iot-activation" target="_blank"><i class="fa fa-github"></i> <span>Github</span></a></li>
        </ul>
      </div>
    </div>


    <div class="col-md-12 blog-theme-class">
          <!-- Top Blog Header -->
          <div class="row jumb-bot">
            <div class="col-md-1"></div>
            <div class="jumbotron jumb-bot-jumbu col-md-10">

              <h1>IoT Activation</h1>
              <p>Welcome to the Revolu<strong>IOT</strong>n</p>
            </div>            
            <div class="col-md-1"></div>
          </div>
    </div>
    <div class="col-md-12">
        <div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-10">

	  	
	    <h1>IPsec</h1>
	    <!--<div id="google_translate_element" style="padding-right: 27px;float: left;"></div><script type="text/javascript">
			function googleTranslateElementInit() {
  				new google.translate.TranslateElement({pageLanguage: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
				}
		</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
		-->
	    <p class="post-meta">Feb 6, 2019</p>

	   
	  	<article class="blog-post-small blog-post-content">
	    	<h3 id="table-of-contents">Table of Contents</h3>

<ul>
  <li><a href="#what-is-ipsec">What is IPsec?</a>
    <ul>
      <li><a href="#what-will-you-need">What will you need?</a></li>
      <li><a href="#what-does-it-do">What does it do?</a></li>
    </ul>
  </li>
  <li><a href="#how-to-make-your-own-ipsec-vpn">How to make your own IPsec VPN!</a>
    <ul>
      <li><a href="#request-a-private-apn-to-telefónica">Request private APN to Telefónica</a>
        <h4 id="table-of-contents-ipsec-in-aws">Table of Contents IPsec in AWS</h4>
      </li>
    </ul>
  </li>
  <li><a href="#configure-ipsec-step-by-step-in-aws">Configure IPsec step by step in AWS</a>
    <ul>
      <li><a href="#1-create-vpc">1. Create VPC</a></li>
      <li><a href="#2-create-vpg">2. Create VPG</a>
        <ul>
          <li><a href="#21-attach-vpg-to-vpc">2.1. Attach VPG to VPC</a></li>
        </ul>
      </li>
      <li><a href="#3-enable-propagation-of-routes-from-vpg">3. Enable propagation of routes from VPG</a>
        <ul>
          <li><a href="#31-edit-route-table">3.1. Edit Route Table</a></li>
        </ul>
      </li>
      <li><a href="#4-create-two-customer-gateway">4. Create two customer Gateway</a></li>
      <li><a href="#5-create-two-vpn-connection">5. Create two VPN Connection</a>
        <ul>
          <li><a href="#51-download-configuration">5.1. Download Configuration</a></li>
        </ul>
      </li>
      <li><a href="#6-create-an-ec2-instance">6. Create an EC2 instance</a>
        <ul>
          <li><a href="#61-launch-ec2-instance">6.1. Launch EC2 instance</a></li>
          <li><a href="#62-create-a-subnet">6.2. Create a Subnet</a></li>
          <li><a href="#63-enable-internet-connection-ec2-instance">6.3. Enable Internet Connection EC2 instance</a></li>
          <li><a href="#64-attach-to-vpc">6.4. Attach to VPC</a></li>
          <li><a href="#65-enable-a-new-route">6.5. Enable a new Route</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="what-is-ipsec">What is IPsec?</h1>

<p>IPsec is one of the most important security protocols. It was created to provide security in network and in transport layer.
It guarantees the security using both TCP and UDP protocols.</p>

<p>IPsec protects data flows between two security gateways. It allows two networks to be connected.
It also includes a series of protocols to establish authentication between networks.</p>

<p>Its main purpose is to create a Private Networks (VPN).</p>

<p><img src="pictures/schematics/IPsec_diagram.png" alt="pic" /></p>

<h2 id="what-will-you-need">What will you need?</h2>

<ul>
  <li>Telefónica SIM with private APN (IPsec)</li>
  <li>A Cloud machine with IPsec tunnel</li>
</ul>

<h2 id="what-does-it-do">What does it do?</h2>

<p>When you request your SIMs from Telefónica, you can ask for a private APN. This APN includes your SIMs in a new network.
The goal is to establish a direct connection between your network and the Cloud.</p>

<p>The IPsec guarantee that two networks work as one. It provides a secure connection between them.</p>

<p><a href="#table-of-contents"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h1 id="how-to-make-your-own-ipsec-vpn">How to make your own IPsec VPN!</h1>

<p>We believe in the importance of your data, for this reason we want to provide you a secure network.</p>

<p>Benefits:</p>
<ul>
  <li>Enhanced security</li>
  <li>Integration cost and time reduction: customers don’t need to create ad-hoc VPN integration processes.</li>
</ul>

<h2 id="request-a-private-apn-to-telefónica">Request a private APN to Telefónica</h2>

<p>We assume that because you are following this tutorial with us, you are interested in connecting your devices 
through Telefónica’s network.</p>

<p>It is important for you to know that when you request for new SIM’s you can ask for the creation of 
your own APN (Access Point Name).</p>

<p>This new APN can be set to have its own IP’s range. This range cannot correspond to your own network. 
An example of networks that you can request are the following:</p>

<ul>
  <li>Class A: up to 16777215 devices xxx.0.0.0/8</li>
  <li>Class B: up to 65535 devices    xxx.xxx.0.0/16</li>
  <li>Class C: up to 255 devices      xxx.xxx.xxx.0/24</li>
</ul>

<p>Where you can choose a desired range: <strong>192.168.0.0/24</strong></p>

<p>This range includes the IP address from 192.168.0.0 to 192.168.0.255.</p>

<p>In addition to the range you must provide to Telefónica the internet gateways configuration.</p>

<p>This setting will depend on your public cloud</p>

<p><a href="#table-of-contents"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h1 id="configure-ipsec-step-by-step-in-aws">Configure IPsec step by step in AWS</h1>

<p>On Amazon, IPsec tunnels are created using VPN Connections. When a VPN connection is created between the Virtual Private Gateway
and the Customer Gateway (Telefónica Encrypter)
automatically assigns two public IPs to its VPG. This are de IPs on the Amazon side.</p>

<p>Amazon provide a redundant connection. In other words, you’ll need create two gateways.</p>

<p>It is illustrated in the diagram below.</p>

<p><img src="pictures/IPsec/IPsec_AWS_00_Overview.png" alt="pic" /></p>

<p>The following tutorial intends to be a simple guide to configure the IPsec between an EC2 machine and your pool of SIMs 
from the Telefónica’s network.</p>

<p>Follow this tutorial to build an IPsec in AWS and learn how to do it step by step, but if you prefer, 
you can build it in <a href="AWSCFIPsec.html">one click</a></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h2 id="1-create-vpc">1. Create VPC</h2>

<p><strong>What Is Amazon VPC?</strong></p>

<p>Amazon Virtual Private Cloud (Amazon VPC) enables you to launch AWS resources into a virtual network.
This virtual network closely resembles a traditional network that you’d operate in your own data center.</p>

<p>Go to <strong>VPC Dashboard / Virtual Private Cloud / Your VPCs /</strong> Select: <strong>Create VPC</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_01_VPCdashboard_CreateVPC.png" alt="pic" /></p>

<p>Fill in the fields:</p>

<ul>
  <li>
    <p><strong>Name tag:</strong> Select a name for identifying your VPC in the next steps</p>
  </li>
  <li>
    <p><strong>IPv4 CIDR block:</strong> Select your network range. It must not match the range of your SIM pool</p>
  </li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_01_VPCdashboard_CreateVPC_config.png" alt="pic" /></p>

<p>Click on <strong>create</strong>.</p>

<p>Now you can see the new VPC</p>

<p><img src="pictures/IPsec/IPsec_AWS_01_VPCdashboard_CreateVPC_config_end.png" alt="pic" /></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h2 id="2-create-virtual-private-gateway">2. Create Virtual Private Gateway</h2>

<p>The VPG provides a link between the VPC and an external environment.</p>

<p>Go to <strong>VPC Dashboard / Virtual Private Network / Virtual Private Gateway /</strong> Select: <strong>Create Virtual Private Gateway</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_02_VPCdashboard_CreateVPG.png" alt="pic" /></p>

<p><strong>Name tag:</strong> Select a name for identifying your VPG in the next steps</p>

<p><img src="pictures/IPsec/IPsec_AWS_02_VPCdashboard_CreateVPG_config.png" alt="pic" /></p>

<p>Click on <strong>create</strong>.</p>

<p>Now you can see the new VPG</p>

<p><img src="pictures/IPsec/IPsec_AWS_02_VPCdashboard_CreateVPG_config_done.png" alt="pic" /></p>

<p>Now you can check the VPG status and read in red <strong>detached</strong>
The VPG is created, but you need to attach it to the VPC.</p>

<h3 id="21-attach-vpg-to-vpc">2.1. Attach VPG to VPC</h3>

<p>On the previous screen 
<strong>VPC Dashboard / Virtual Private Network / Virtual Private Gateway</strong></p>

<p>Select your VPG: 
<strong>Actions</strong> button / Select: <strong>Attach to VPC</strong></p>

<p>Select your VPC <strong>Name tag</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_02_VPCdashboard_CreateVPG_config_end_attach.png" alt="pic" /></p>

<p>Click on <strong>Yes, Attach</strong></p>

<p>Wait a moment until it appears <strong>attached</strong></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h2 id="3-enable-propagation-of-routes-from-vpg">3. Enable propagation of routes from VPG</h2>

<p>To allow your VPC to reach other services. 
You must include the routes used by your VPN connection in the routing tables. They have to point to your VPG.</p>

<h3 id="31-edit-route-table">3.1. Edit Route Table</h3>

<p>You can enable route propagation for your route table to automatically propagate it.</p>

<p>Go to <strong>VPC Dashboard / Virtual Private Cloud / Route Tables</strong></p>

<p>Select the table with your VPC and in the bottom menu select the tab:</p>

<p><strong>Route Propagation / Edit route propagation</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_03_VPCdashboard_RouteTables.png" alt="pic" /></p>

<p>A new window opens to activate it</p>

<p><img src="pictures/IPsec/IPsec_AWS_03_VPCdashboard_RouteTables_propagation.png" alt="pic" /></p>

<p>Click on <strong>Save</strong></p>

<p>Now you can see route propagate to <strong>YES</strong></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h2 id="4-create-two-customer-gateway">4. Create two Customer Gateway</h2>

<p>The customer gateway is the connection between your network and the VPC.
To be able to connect to the Telefónica network it is necessary to establish two Gateway with the two Telefónica’s encrypters.</p>

<p>Go to <strong>VPC Dashboard / Virtual Private Network (VPN) / Customer Gateway /</strong> Select: <strong>Create Customer Gateway</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_04_VPCdashboard_CustomerGateway_CreateCG.png" alt="pic" /></p>

<p>fill in the fields with the following information:</p>

<ul>
  <li><strong>Encrypter3:</strong>
    <ul>
      <li>Name: TEF_Cifra3</li>
      <li>Routing: Dynamic</li>
      <li>BGP ASN: 3352</li>
      <li>IP Address: 213.0.185.6</li>
    </ul>
  </li>
  <li><strong>Encrypter4:</strong>
    <ul>
      <li>Name: TEF_Cifra4</li>
      <li>Routing: Dynamic</li>
      <li>BGP ASN: 3352</li>
      <li>IP Address: 213.0.185.8</li>
    </ul>
  </li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_04_VPCdashboard_CustomerGateway_CreateCG_config.png" alt="pic" /></p>

<p>Once the Customers Gateway corresponding to the Telefónica’s encrypters have been created, they appear as shown below:</p>

<p><img src="pictures/IPsec/IPsec_AWS_04_VPCdashboard_CustomerGateway_CreateCG_config_done.png" alt="pic" /></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h2 id="5-create-two-vpn-connection">5. Create two VPN Connection</h2>

<p>You must create a VPN connection for each of the two customer gateways corresponding to Telefónica’s two encryption devices.</p>

<p>Go to <strong>VPC Dashboard / Virtual Private Network (VPN) / Site-to-Site VPN /</strong> Select: <strong>Create VPN Connection</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_05_VPCdashboard_VPNconnection_createVPNc.png" alt="pic" /></p>

<ul>
  <li>
    <p><strong>Name tag:</strong> Select a name for identifying your VPC connection in the next steps</p>
  </li>
  <li>
    <p><strong>VPG</strong> Select your VPN Gateway attached to your VPC</p>
  </li>
  <li>
    <p><strong>Customer Gateway</strong> Existing</p>
  </li>
  <li>
    <p><strong>Customer Gateway ID</strong> Select each of the two Customers Gateway created</p>
  </li>
  <li>
    <p><strong>Routing Options</strong> Dynamic</p>
  </li>
</ul>

<p><strong>for the First VPN connection:</strong></p>

<ul>
  <li>
    <p><strong>Inside IP CIDR for Tunnel 1</strong>  169.254.30.0/30</p>
  </li>
  <li>
    <p><strong>Inside IP CIDR for Tunnel 2</strong>  169.254.30.4/30</p>
  </li>
</ul>

<p><strong>and for the Second VPN connection:</strong></p>

<ul>
  <li>
    <p><strong>Inside IP CIDR for Tunnel 1</strong>  169.254.40.0/30</p>
  </li>
  <li>
    <p><strong>Inside IP CIDR for Tunnel 2</strong>  169.254.40.4/30</p>
  </li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_05_VPCdashboard_VPNconnection_createVPNc_config1.png" alt="pic" />
<img src="pictures/IPsec/IPsec_AWS_05_VPCdashboard_VPNconnection_createVPNc_config2.png" alt="pic" />
<img src="pictures/IPsec/IPsec_AWS_05_VPCdashboard_VPNconnection_createVPNc_config3.png" alt="pic" /></p>

<p>Click on <strong>Create VPN Connection</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_05_VPCdashboard_VPNconnection_createVPNc_config_done.png" alt="pic" /></p>

<p>Now you can read in the tab <strong>Tunnel Detail</strong> the status in red <strong>DOWN</strong></p>

<p>This will hold, until you contact to Telefónica and send them the configuration.</p>

<h3 id="51-download-configuration">5.1. Download Configuration</h3>

<p>Amazon offers you the possibility to download a configuration file for the Customer Gateway.
You will need provide this file to Telefónica.</p>

<p>Clicking on each encrypter, select the tab <strong>Download Configuration</strong> and fill like the following example</p>

<p><img src="pictures/IPsec/IPsec_AWS_05_VPCdashboard_VPNconnection_createVPNc_config_download.png" alt="pic" /></p>

<p>You keep these two files that they are necessary to configure the other tunnel end.</p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h2 id="6-create-an-ec2-instance">6. Create an EC2 instance</h2>

<p>Amazon Elastic Compute Cloud (Amazon EC2) is a web service that provides secure, resizable compute capacity in the cloud. 
It is designed to make web-scale cloud computing easier for developers.</p>

<p>In this case, we have decided to use a linux instance, but you can use others.
Just check that the image can execute Python code</p>

<h3 id="61-launch-ec2-instance">6.1. Launch EC2 instance</h3>

<p>Go to <strong>EC2 Dashboard / Instances / Instances /</strong> Select: <strong>Launch Instance</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch.png" alt="pic" /></p>

<p><strong>Step 1:</strong> Choose the OS (AMI)</p>

<p><img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch_step1.png" alt="pic" /></p>

<p>Click <strong>Next</strong></p>

<p><strong>Step 2:</strong> Choose the machine size</p>

<p><img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch_step2.png" alt="pic" /></p>

<p>Click <strong>Next</strong></p>

<p><strong>Step 3:</strong> Configure the machine network connection</p>

<ul>
  <li>
    <p><strong>Network:</strong> Select your VPC</p>
  </li>
  <li>
    <p><strong>Subnet:</strong> Create a new Subnet (it will continue in the <a href="#62-create-a-subnet">step 6.2</a>)</p>
  </li>
  <li>
    <p><strong>Auto-assigns Public IP:</strong> Enable</p>
  </li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch_step3.png" alt="pic" />
<img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch_step3a.png" alt="pic" /></p>

<p>Click <strong>Next</strong> until Step 6</p>

<p><strong>Step 6:</strong> Open a Port to test the connection</p>

<ul>
  <li>
    <p><strong>Assign a security group:</strong> Create a new security group</p>
  </li>
  <li>
    <p><strong>Security group name:</strong> Select a name for identifying your Security group in the next steps</p>
  </li>
  <li>
    <p><strong>Add Rule:</strong> Custom ICMP like the picture for enable the ping response</p>
  </li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch_step6.png" alt="pic" /></p>

<p>Now your machine is running, but it is connected to a virtual network. You must configurate an internet gateway to
enable the <a href="#63-enable-internet-connection-ec2-instance">internet connection</a></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h3 id="62-create-a-subnet">6.2. Create a Subnet</h3>

<p>A subnet is a range of IP addresses in your VPC. You need launch your EC2 instance into a specified subnet.</p>

<ul>
  <li>
    <p><strong>Name tag:</strong> Select a name for identifying your Subnet in the next steps</p>
  </li>
  <li>
    <p><strong>VPC:</strong> Select your VPC</p>
  </li>
  <li>
    <p><strong>IPv4 CIDR block:</strong> use the same IP range but choose a smaller mask</p>
  </li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch_step3_subnet1.png" alt="pic" />
<img src="pictures/IPsec/IPsec_AWS_06_EC2dashboard_Instance_launch_step3_subnet2.png" alt="pic" /></p>

<p>Click on <strong>Create</strong></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h3 id="63-enable-internet-connection-ec2-instance">6.3. Enable Internet Connection EC2 instance</h3>

<p>You have previously created a gateway to connect your network with the VPN of AWS. 
This is a similar step for connecting the VPN to an external network (Internet).</p>

<p>Go to VPC <strong>Dashboard / Virtual Private Cloud / Internet Gateway /</strong> Select: <strong>Create internet gateway</strong></p>

<p><img src="pictures/IPsec/IPsec_AWS_06_VirtualPrivateCloud_InternetGateway_CreateIG.png" alt="pic" /></p>

<ul>
  <li><strong>Name tag:</strong> Select a name for identifying the gateway in the next steps</li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_06_VirtualPrivateCloud_InternetGateway_CreateIG_config.png" alt="pic" /></p>

<p>Click on <strong>Create</strong></p>

<p>Now that you have created the VPG, connect it to the VPN</p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h3 id="64-attach-to-vpc">6.4. Attach to VPC</h3>

<p>Now select the Internet Gateway and select <strong>attach to VPC</strong> on <strong>Actions</strong> button</p>

<p><img src="pictures/IPsec/IPsec_AWS_06_VirtualPrivateCloud_InternetGateway_CreateIG_config_attach.png" alt="pic" /></p>

<ul>
  <li><strong>VPC</strong> Select the VPC</li>
</ul>

<p><img src="pictures/IPsec/IPsec_AWS_06_VirtualPrivateCloud_InternetGateway_CreateIG_config_attach_VPC.png" alt="pic" /></p>

<p>Click on <strong>Attach</strong></p>

<p>Now you have access to an internet gateway, you only have to modify the rules of the gateway to allow traffic.</p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

<h3 id="65-enable-a-new-route">6.5. Enable a new Route</h3>

<p>Go to <strong>VPC Dashboard / Virtual Private Cloud / Route Table /</strong> Select the route table of the VPC</p>

<p>On the <strong>Routes</strong> tab, click on <strong>Edit Routes</strong> button</p>

<p><img src="pictures/IPsec/IPsec_AWS_06_VirtualPrivateCloud_RouteTables.png" alt="pic" /></p>

<p>Add a new route with the interface 0.0.0.0/0
and select the internet gateway like target.</p>

<p><img src="pictures/IPsec/IPsec_AWS_06_VirtualPrivateCloud_RouteTables_editroute.png" alt="pic" /></p>

<p><a href="#table-of-contents-ipsec-in-aws"><img src="pictures/utils/arrow_up.png" alt="pic" /></a></p>

	  	</article>
	  	
	  	
	  	
<!-- Output author details if some exist. -->
   

    <!--ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="iot-activation/BPDataBridgeGoogleCloud.html" title="Previous Post:
        Data Bridge on Google Cloud">&laquo; Data Bridge on Google Cloud</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
      <li class="next"><a class="basic-alignment right" 
	    href="iot-activation/KitePlatform.html" title="Next Post: 
		Kite Platform">Kite Platform
        &raquo;</a></li>
      
    </ul-->
	</div>
	<div class="col-md-1"></div>
</div>
    </div>
    <div class="col-md-12 share-div">
        <div class="col-md-1"></div>
        <div class="col-md-10">
          
<div class="fb_share">
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	  if (d.getElementById(id)) return;
	  js = d.createElement(s); js.id = id;
	  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=354997024639145&version=v2.0";
	  fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-share-button" data-layout="button_count"></div>
</div>



<div class="twitter_share">
	<a href="https://twitter.com/share" class="twitter-share-button" data-via="TelefonicaIoT" data-hashtags="sailsjs">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>



<div class="linkedin_share">
	<script src="//platform.linkedin.com/in.js" type="text/javascript">
	  lang: en_US
	</script>
	<script type="IN/Share" data-counter="right"></script>
</div>



<div class="g_share">
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<div class="g-plus" data-action="share" data-annotation="bubble"></div>
</div>

        </div>
        <div class="col-md-1"></div>
    </div>
    <div class="col-md-12">
    
    </div>
    <div class="col-md-12">
    			<div class="row end_footer">
              <div class="col-md-1"></div>
              <div class="col-md-6">
                
              </div>
              <div class="col-md-4"></div>
              <div class="col-md-1"></div>
            </div>
    </div>
        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/prettify.js"></script>
    <script>
      [].forEach.call(document.getElementsByTagName("pre"), function(el) {
        el.classList.add("prettyprint");
      });

      prettyPrint();
    </script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>

    <style>
      pre.prettyprint {

        font-size: 13px;
        font-family: "Open Sans";
        padding: 8px 12px;
        border: 1px solid #bbb;
        border-radius: 4px;
      }
    </style>

  </body>

</html>
